# Deployment Guide

## Project Structure

The project has been cleaned up and organized into the following structure:

```
coaching-site/
├── backend/
│   ├── tests/          # All test files
│   ├── scripts/        # Migration and utility scripts
│   ├── migrations/     # Database migration files
│   ├── data/           # SQLite database and data files
│   ├── logs/           # Application logs
│   ├── main.py         # Main FastAPI application
│   ├── requirements.txt # Python dependencies
│   ├── Dockerfile      # Backend Docker configuration
│   └── render.yaml     # Render deployment configuration
├── frontend/
│   ├── components/     # React components
│   ├── pages/          # Next.js pages
│   ├── public/         # Static assets
│   ├── styles/         # CSS and styling
│   ├── package.json    # Node.js dependencies
│   ├── Dockerfile      # Frontend Docker configuration
│   └── render.yaml     # Render deployment configuration
├── docs/               # Documentation files
├── .env                # Environment variables
├── .env.example        # Environment variables template
├── .env.development    # Development environment variables
└── docker-compose.yml  # Docker Compose configuration
```

## Render Deployment

### Backend Deployment

1. **Create a new Web Service on Render**:
   - Connect your GitHub repository
   - Select the `backend` directory as the root directory
   - Use the following build command: `pip install -r requirements.txt`
   - Use the following start command: `python -m uvicorn main:app --host 0.0.0.0 --port $PORT`

2. **Environment Variables**:
   Set the following environment variables in the Render dashboard:
   - `MAILERLITE_API_KEY`: Your MailerLite API key
   - `MAILERLITE_WEBHOOK_SECRET`: Your MailerLite webhook secret
   - `JWT_SECRET_KEY`: A secure JWT secret key
   - `ADMIN_PASSWORD`: Admin password for the dashboard
   - `DATABASE_URL`: PostgreSQL connection string (auto-generated by Render)

3. **Database Setup**:
   - Create a PostgreSQL database on Render
   - The `DATABASE_URL` will be automatically provided
   - Run migration scripts after deployment

### Frontend Deployment

1. **Create a new Static Site on Render**:
   - Connect your GitHub repository
   - Select the `frontend` directory as the root directory
   - Use the following build command: `npm install && npm run build && npm run export`
   - Set publish directory to `./out`

2. **Environment Variables**:
   Set the following environment variables in the Render dashboard:
   - `NEXT_PUBLIC_SITE_URL`: Your frontend domain (e.g., https://www.peter-stoyanov.com)
   - `NEXT_PUBLIC_API_URL`: Your backend API URL (e.g., https://peter-stoyanov-backend.onrender.com)

### Email Automation

The email automation system includes:
- **Email Scheduler**: Automated email sequences for new subscribers
- **Webhook Handlers**: Real-time processing of MailerLite webhooks
- **Subscriber Segmentation**: Automated grouping based on user behavior

To set up email automation:
1. Configure MailerLite API credentials
2. Set up webhook endpoints in MailerLite dashboard
3. Deploy the email scheduler as a cron job on Render

### Domain Configuration

1. **Backend Domain**: `peter-stoyanov-backend.onrender.com`
2. **Frontend Domain**: `www.peter-stoyanov.com` (configure custom domain in Render)

### Security Considerations

- All sensitive data is stored in environment variables
- JWT tokens are used for admin authentication
- Database connections use SSL in production
- CORS is configured for frontend-backend communication

### Monitoring and Logs

- Application logs are stored in the `logs/` directory
- Use Render's built-in monitoring for uptime and performance
- Set up health checks for both frontend and backend services

## Local Development

1. **Backend**:
   ```bash
   cd backend
   pip install -r requirements.txt
   python main.py
   ```

2. **Frontend**:
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

3. **Docker**:
   ```bash
   docker-compose up
   ```

## Migration from Previous Setup

1. Export data from existing database
2. Update environment variables for new domains
3. Run database migrations
4. Test all functionality before switching DNS

## Post-Deployment Checklist

- [ ] Verify backend API endpoints are working
- [ ] Test frontend-backend communication
- [ ] Confirm email automation is functioning
- [ ] Verify SSL certificates are active
- [ ] Test all forms and user interactions
- [ ] Monitor logs for any errors
- [ ] Update DNS records for custom domain